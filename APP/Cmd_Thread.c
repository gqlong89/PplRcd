
#include "cmsis_os.h"                                           // CMSIS RTOS header file
#include "sys_cmd.h"
/*----------------------------------------------------------------------------
 *      Thread 1 'Thread_Name': Sample thread
 *---------------------------------------------------------------------------*/
 
                // thread object






//============================================================================//
//            G L O B A L   D E F I N I T I O N S                             //
//============================================================================//

//------------------------------------------------------------------------------
// const defines
//------------------------------------------------------------------------------

//------------------------------------------------------------------------------
// module global vars
//------------------------------------------------------------------------------


//------------------------------------------------------------------------------
// global function prototypes
//------------------------------------------------------------------------------

//============================================================================//
//            P R I V A T E   D E F I N I T I O N S                           //
//============================================================================//

//------------------------------------------------------------------------------
// const defines
//------------------------------------------------------------------------------

//------------------------------------------------------------------------------
// local types
//------------------------------------------------------------------------------
typedef struct {
	cmd_recv 		func;
	void 			*arg;
	
}cmd_run_t;
//------------------------------------------------------------------------------
// local vars
//------------------------------------------------------------------------------
static void Cmd_Thread (void const *argument);
osThreadId tid_cmd_Thread;                                          // thread id
osThreadDef (Cmd_Thread, osPriorityBelowNormal, 1, 0);   

static cmd_run_t 	cmd_run;
//------------------------------------------------------------------------------
// local function prototypes
//------------------------------------------------------------------------------

int	Cmd_Rgt_recv(cmd_recv	crv, void *arg)
{
	cmd_run.func = crv;
	cmd_run.arg = arg;
	return 0;
	
}
void Cmd_del_recv(int	cmd_fd)
{
	cmd_run.func = NULL;
	
}

//============================================================================//
//            P U B L I C   F U N C T I O N S                                 //
//============================================================================//
int Init_Cmd_Thread (void) {

  tid_cmd_Thread = osThreadCreate (osThread(Cmd_Thread), NULL);
  if (!tid_cmd_Thread) return(-1);
  
  return(0);
}



//=========================================================================//
//                                                                         //
//          P R I V A T E   D E F I N I T I O N S                          //
//                                                                         //
//=========================================================================//
/// \name Private Functions
/// \{
static void Cmd_Thread (void const *argument) {

  while (1) {
    ; // Insert thread code here...
		if(cmd_run.func)
			cmd_run.func(cmd_run.arg);
    osThreadYield ();  		// suspend thread
  }
}


