//============================================================================//
//            G L O B A L   D E F I N I T I O N S                             //
//============================================================================//
#include "stm32f10x.h"
#include "stm32f10x_pwr.h"
#include "power.h"
#include "system.h"
#include "sdhDef.h"
#include "device.h"
#include "glyph.h"
//------------------------------------------------------------------------------
// const defines
//------------------------------------------------------------------------------

//------------------------------------------------------------------------------
// module global vars
//------------------------------------------------------------------------------


//------------------------------------------------------------------------------
// global function prototypes
//------------------------------------------------------------------------------

//============================================================================//
//            P R I V A T E   D E F I N I T I O N S                           //
//============================================================================//

//------------------------------------------------------------------------------
// const defines
//------------------------------------------------------------------------------

//------------------------------------------------------------------------------
// local types
//------------------------------------------------------------------------------

//------------------------------------------------------------------------------
// local vars
//------------------------------------------------------------------------------


//------------------------------------------------------------------------------
// local function prototypes
//------------------------------------------------------------------------------



//============================================================================//
//            P U B L I C   F U N C T I O N S                                 //
//============================================================================//
int PVD_Init(void)
{
	EXTI_InitTypeDef exti_param;
	
	RCC_APB1PeriphClockCmd(RCC_APB1Periph_PWR, ENABLE);
	PWR_PVDLevelConfig(PWR_PVDLevel_2V9); 
	PWR_PVDCmd(ENABLE); 
	
	EXTI_DeInit();
	
	EXTI_StructInit(&exti_param);
	exti_param.EXTI_Line = EXTI_Line16; 
	exti_param.EXTI_Mode = EXTI_Mode_Interrupt; //??????
	exti_param.EXTI_Trigger = EXTI_Trigger_Rising_Falling; //电压从高下降到低于设定阀值时产生中断
	exti_param.EXTI_LineCmd = ENABLE; // ?????
	EXTI_ClearITPendingBit(EXTI_Line16);
	EXTI_Init(&exti_param); // ??
	
	
	
	return RET_OK;
	
}

void PVD_IRQHandler(void)
{
//	I_dev_lcd 				*tdd_lcd;

//	Dev_open(LCD_DEVID, (void *)&tdd_lcd);
//	tdd_lcd->Clear( COLOUR_YELLOW);
	
	phn_sys.sys_flag |= SYSFLAG_POWERON;
	
//	System_power_off();
	EXTI_ClearITPendingBit(EXTI_Line16);
	
}
//=========================================================================//
//                                                                         //
//          P R I V A T E   D E F I N I T I O N S                          //
//                                                                         //
//=========================================================================//
/// \name Private Functions
/// \{
